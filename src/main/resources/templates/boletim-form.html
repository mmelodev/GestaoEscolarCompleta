<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lan√ßamento de Boletim - AriranG</title>
    <link rel="stylesheet" th:href="@{/css/cadastro.css?v=1.0}" />
    <link rel="stylesheet" th:href="@{/css/forms.css?v=1.1}" />
    <link rel="stylesheet" th:href="@{/css/header.css?v=2.1}" />
    <link rel="stylesheet" th:href="@{/css/home.css?v=1.0}" />
    <style>
        .form-card, .form-card h1, .form-card label { color: #1a1a1a; }
        .form-card input, .form-card select, .form-card textarea { color: #1a1a1a; }
        .nota-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .nota-section h3 { margin-top: 0; color: #333; }
        .nota-item { display: flex; align-items: center; gap: 10px; margin: 10px 0; }
        .nota-item input[type="text"], .nota-item input[type="number"] { flex: 1; }
        .nota-item input[type="number"] { width: 80px; }
        .btn-remove { background: #d32f2f; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .btn-add { background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 10px 0; }
        .media-section { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .status-section { background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .status-aprovado { color: #2e7d32; font-weight: bold; }
        .status-reprovado { color: #d32f2f; font-weight: bold; }
        .status-andamento { color: #f57c00; font-weight: bold; }
        .btn-finalizar { background: #1976d2; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        .btn-finalizar:disabled { background: #ccc; cursor: not-allowed; }

        /* Mobile */
        @media (max-width: 767px) {
            .nota-item { flex-direction: column; align-items: stretch; }
            .nota-item input[type="number"] { width: 100%; }
            .btn-add, .btn-remove { width: 100%; }
            .media-section form[style*="display: flex"] { flex-direction: column; align-items: stretch !important; }
            .media-section input[type="number"] { width: 100% !important; }
            .media-section button { width: 100%; }
            /* Bot√µes finais em coluna */
            .actions form, .actions a { width: 100%; }
            .actions button { width: 100%; margin-right: 0 !important; margin-left: 0 !important; }
            .actions a.btn-primary { margin-left: 0 !important; }
        }
    </style>
</head>
<body>
<header>
    <div class="main-nav" style="margin-bottom: 1rem;">
        <div class="logo">
            <a th:href="@{/}"><img th:src="@{/img/horizontal_negativa.png}" alt="Logo" /></a>
        </div>
        <nav>
            <!-- Bot√£o Hamb√∫rguer - Mobile -->
            <button class="menu-toggle" id="menuToggle" aria-label="Abrir menu" aria-expanded="false" aria-controls="navList">
                <span></span>
                <span></span>
                <span></span>
            </button>

            <ul class="nav-list" id="navList">
                <a th:href="@{/}"><li class="nav-element">Home</li></a>
                <a th:href="@{/alunos/lista}"><li class="nav-element">Alunos</li></a>
                <a th:href="@{/turmas}"><li class="nav-element">Turmas</li></a>
                <a th:href="@{/cadastro}"><li class="nav-element active">Cadastro</li></a>
                <a sec:authorize="isAuthenticated()" th:href="@{/perfil}"><li class="nav-element">Meu Perfil</li></a>
                <a sec:authorize="isAuthenticated()" th:href="@{/configuracao}"><li class="nav-element">üé® Personaliza√ß√£o</li></a>
            </ul>
        </nav>
    </div>
    <div class="menu-overlay" id="menuOverlay" aria-hidden="true"></div>
</header>

<div class="page-container">
    <div class="form-card">
        <h1 style="margin-top:0">Lan√ßamento de Boletim</h1>
        
        <div class="media-section">
            <h3>Informa√ß√µes do Aluno</h3>
            <p><strong>Nome:</strong> <span th:text="${boletim.alunoNome}"></span></p>
            <p><strong>Turma:</strong> <span th:text="${boletim.turmaNome}"></span></p>
        </div>

        <!-- Exerc√≠cios -->
        <div class="nota-section">
            <h3>Exerc√≠cios</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'EXERCICIO'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="EXERCICIO" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o do exerc√≠cio" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Exerc√≠cio</button>
                </div>
            </form>
        </div>

        <!-- Trabalhos -->
        <div class="nota-section">
            <h3>Trabalhos</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'TRABALHO'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="TRABALHO" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o do trabalho" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Trabalho</button>
                </div>
            </form>
        </div>

        <!-- Avalia√ß√µes -->
        <div class="nota-section">
            <h3>Avalia√ß√µes</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'AVALIACAO'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="AVALIACAO" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da avalia√ß√£o" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Avalia√ß√£o</button>
                </div>
            </form>
        </div>

        <!-- Produ√ß√£o Oral -->
        <div class="nota-section">
            <h3>Produ√ß√£o Oral</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'PRODUCAO_ORAL'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="PRODUCAO_ORAL" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da produ√ß√£o oral" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Produ√ß√£o Oral</button>
                </div>
            </form>
        </div>

        <!-- Produ√ß√£o Escrita -->
        <div class="nota-section">
            <h3>Produ√ß√£o Escrita</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'PRODUCAO_ESCRITA'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="PRODUCAO_ESCRITA" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da produ√ß√£o escrita" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Produ√ß√£o Escrita</button>
                </div>
            </form>
        </div>

        <!-- Compreens√£o Oral -->
        <div class="nota-section">
            <h3>Compreens√£o Oral</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'COMPREENSAO_ORAL'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="COMPREENSAO_ORAL" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da compreens√£o oral" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Compreens√£o Oral</button>
                </div>
            </form>
        </div>

        <!-- Compreens√£o Escrita -->
        <div class="nota-section">
            <h3>Compreens√£o Escrita</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'COMPREENSAO_ESCRITA'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="COMPREENSAO_ESCRITA" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da compreens√£o escrita" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Compreens√£o Escrita</button>
                </div>
            </form>
        </div>

        <!-- Prova Final -->
        <div class="nota-section">
            <h3>Prova Final</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'PROVA_FINAL'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="PROVA_FINAL" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da prova final" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Prova Final</button>
                </div>
            </form>
        </div>

        <!-- Presen√ßa -->
        <div class="nota-section">
            <h3>Presen√ßa</h3>
            <div th:each="nota : ${boletim.notas}" th:if="${nota.tipoNota.name() == 'PRESENCA'}">
                <div class="nota-item">
                    <input type="text" th:value="${nota.descricao}" readonly />
                    <input type="number" th:value="${nota.valorNota}" readonly />
                    <form th:action="@{/boletim/remover-nota/{id}(id=${nota.id})}" method="post" style="display: inline;">
                        <!-- CSRF Token -->
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <input type="hidden" name="alunoId" th:value="${alunoId}" />
                        <input type="hidden" name="turmaId" th:value="${turmaId}" />
                        <button type="submit" class="btn-remove">Remover</button>
                    </form>
                </div>
            </div>
            <form th:action="@{/boletim/adicionar-nota}" method="post">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="boletimId" th:value="${boletim.id}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <input type="hidden" name="tipoNota" value="PRESENCA" />
                <div class="nota-item">
                    <input type="text" name="descricao" placeholder="Descri√ß√£o da presen√ßa" required />
                    <input type="number" name="valorNota" min="1" max="100" placeholder="Nota" required />
                    <button type="submit" class="btn-add">Adicionar Presen√ßa</button>
                </div>
            </form>
        </div>

        <!-- M√©dia e Status -->
        <div class="media-section">
            <h3>M√©dia Final</h3>
            <form th:action="@{/boletim/atualizar-media/{id}(id=${boletim.id})}" method="post" style="display: flex; align-items: center; gap: 10px;">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <label style="font-weight: bold;">M√©dia:</label>
                <input type="number" 
                       name="mediaFinal" 
                       step="0.01" 
                       min="0" 
                       max="10" 
                       th:value="${boletim.mediaFinal != null ? boletim.mediaFinal : ''}" 
                       style="padding: 5px; border: 1px solid #ddd; border-radius: 4px; width: 80px;" />
                <button type="submit" class="btn-primary" style="padding: 5px 15px;">Atualizar M√©dia</button>
            </form>
            <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                <em>Voc√™ pode editar a m√©dia final manualmente. A situa√ß√£o ser√° recalculada automaticamente.</em>
            </p>
        </div>

        <div class="status-section">
            <h3>Situa√ß√£o Final</h3>
            <p th:if="${boletim.situacaoFinal != null}" 
               th:class="${boletim.situacaoFinal == 'APROVADO' ? 'status-aprovado' : 
                          boletim.situacaoFinal == 'REPROVADO' ? 'status-reprovado' : 'status-andamento'}"
               th:text="${boletim.situacaoFinal == 'APROVADO' ? 'Aprovado' : 
                         boletim.situacaoFinal == 'REPROVADO' ? 'Reprovado' : 'Em Andamento'}"></p>
            <p th:if="${boletim.situacaoFinal == null}" class="status-andamento">Em Andamento</p>
        </div>

        <div class="actions">
            <form th:action="@{/boletim/salvar/{id}(id=${boletim.id})}" method="post" style="display: inline;">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <button type="submit" class="btn-salvar" th:disabled="${boletim.finalizado}" style="background: #28a745; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-right: 10px;">
                    üíæ Salvar Boletim
                </button>
            </form>
            
            <form th:action="@{/boletim/finalizar/{id}(id=${boletim.id})}" method="post" style="display: inline;">
                <!-- CSRF Token -->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" name="alunoId" th:value="${alunoId}" />
                <input type="hidden" name="turmaId" th:value="${turmaId}" />
                <button type="submit" class="btn-finalizar" th:disabled="${boletim.finalizado}">
                    <span th:text="${boletim.finalizado ? 'Boletim Finalizado' : 'Finalizar Boletim'}"></span>
                </button>
            </form>
            
            <a th:href="@{/alunos/lista}" class="btn-secondary">Voltar</a>
            
            <a th:if="${boletim.finalizado}" 
               th:href="@{/boletim/pdf/{id}(id=${boletim.id})}" 
               class="btn-primary" target="_blank">Visualizar PDF</a>
            
            <a th:if="${boletim.finalizado}" 
               th:href="@{/boletim/download-pdf/{id}(id=${boletim.id})}" 
               class="btn-primary" 
               style="margin-left: 10px; text-decoration: none; display: inline-block; padding: 10px 20px;">
                üì• Baixar PDF
            </a>
        </div>
    </div>
</div>

<script th:inline="javascript">
/* ============================================
   MENU HAMB√öRGUER - Mobile Navigation
   ============================================ */
document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.getElementById('menuToggle');
    const navList = document.getElementById('navList');
    const menuOverlay = document.getElementById('menuOverlay');
    const body = document.body;
    let scrollYBeforeMenu = 0;

    if (!menuToggle || !navList) return;

    function lockPageScroll() {
        scrollYBeforeMenu = window.pageYOffset || document.documentElement.scrollTop || 0;
        body.dataset.scrollYBeforeMenu = String(scrollYBeforeMenu);
        body.style.position = 'fixed';
        body.style.top = `-${scrollYBeforeMenu}px`;
        body.style.left = '0';
        body.style.right = '0';
        body.style.width = '100%';
        body.style.overflow = 'hidden';
    }

    function unlockPageScroll() {
        const y = parseInt(body.dataset.scrollYBeforeMenu || '0', 10) || 0;
        body.style.position = '';
        body.style.top = '';
        body.style.left = '';
        body.style.right = '';
        body.style.width = '';
        body.style.overflow = '';
        delete body.dataset.scrollYBeforeMenu;
        window.scrollTo(0, y);
    }

    function openMenu() {
        navList.classList.add('menu-open');
        menuToggle.classList.add('active');
        menuToggle.setAttribute('aria-expanded', 'true');
        if (menuOverlay) {
            menuOverlay.classList.add('active');
            menuOverlay.setAttribute('aria-hidden', 'false');
        }
        if (window.innerWidth < 1024) lockPageScroll();
    }

    function closeMenu() {
        navList.classList.remove('menu-open');
        menuToggle.classList.remove('active');
        menuToggle.setAttribute('aria-expanded', 'false');
        if (menuOverlay) {
            menuOverlay.classList.remove('active');
            menuOverlay.setAttribute('aria-hidden', 'true');
        }
        unlockPageScroll();
    }

    function toggleMenu() {
        const isOpen = navList.classList.contains('menu-open');
        if (isOpen) closeMenu(); else openMenu();
    }

    menuToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleMenu();
    });

    if (menuOverlay) {
        menuOverlay.addEventListener('click', closeMenu);
    }

    navList.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth < 1024) {
                closeMenu();
            }
        });
    });

    const logoutButton = navList.querySelector('.logout-button');
    if (logoutButton) {
        logoutButton.addEventListener('click', function() {
            if (window.innerWidth < 1024) {
                closeMenu();
            }
        });
    }

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && navList.classList.contains('menu-open')) {
            closeMenu();
            menuToggle.focus();
        }
    });

    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            if (window.innerWidth >= 1024 && navList.classList.contains('menu-open')) {
                closeMenu();
            }
        }, 250);
    });
});
</script>
</body>
</html>
