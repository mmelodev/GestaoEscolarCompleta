<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <title>Meu Perfil - AriranG</title>
    <link rel="stylesheet" th:href="@{/css/header.css}" />
    <link rel="stylesheet" th:href="@{/css/perfil.css?v=1.0}" />
</head>
<body>

<header>
    <div class="main-nav">
        <div class="logo">
            <a th:href="@{/}"><img th:src="@{/img/horizontal_negativa.png}" alt="Logo" /></a>
        </div>
        <nav>
            <ul class="nav-list">
                <a th:href="@{/}"><li class="nav-element">Home</li></a>
                <a sec:authorize="hasAnyRole('ADMIN', 'USER')" th:href="@{/alunos/lista}"><li class="nav-element">Alunos</li></a>
                <a sec:authorize="hasAnyRole('ADMIN', 'USER')" th:href="@{/turmas}"><li class="nav-element">Turmas</li></a>
                <a sec:authorize="hasAnyRole('ADMIN', 'USER')" th:href="@{/contratos}"><li class="nav-element">Contratos</li></a>
                <a sec:authorize="hasAnyRole('ADMIN', 'USER')" th:href="@{/financeiro}"><li class="nav-element">Financeiro</li></a>
                <a sec:authorize="isAuthenticated()" th:href="@{/cadastro}"><li class="nav-element">Cadastro</li></a>
                <a sec:authorize="isAuthenticated()" th:href="@{/perfil}"><li class="nav-element active">Meu Perfil</li></a>
                <a sec:authorize="isAuthenticated()" th:href="@{/configuracao}"><li class="nav-element">üé® Personaliza√ß√£o</li></a>
                <li class="nav-element" sec:authorize="isAuthenticated()">
                    <form th:action="@{/logout}" method="post" class="nav-logout-form">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="logout-button" aria-label="Encerrar sess√£o">Sair</button>
                    </form>
                </li>
                <a sec:authorize="!isAuthenticated()" th:href="@{/login}"><li class="nav-element">Login</li></a>
            </ul>
            <div sec:authorize="isAuthenticated()" class="user-badge">
                <span class="user-badge__icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="8" r="4"></circle>
                        <path d="M4 20a8 8 0 0 1 8-8 8 8 0 0 1 8 8"></path>
                    </svg>
                </span>
                <span class="user-badge__label" th:text="${usuarioPerfil.role()}">Perfil</span>
                <span class="user-badge__name" th:text="${usuarioPerfil.nomeCompleto()}"></span>
            </div>
        </nav>
    </div>
</header>

<main class="profile-wrapper">
    <section class="profile-summary">
        <div class="profile-summary__avatar" th:classappend="${#strings.isEmpty(usuarioPerfil.avatarUrl())} ? ' profile-summary__avatar--placeholder'">
            <img th:if="${!#strings.isEmpty(usuarioPerfil.avatarUrl())}" th:src="${usuarioPerfil.avatarUrl()}" alt="Avatar do usu√°rio" />
            <span th:if="${#strings.isEmpty(usuarioPerfil.avatarUrl())}" th:text="${#strings.substring(usuarioPerfil.nomeCompleto(), 0, 1)}">A</span>
        </div>
        <div class="profile-summary__details">
            <h1 th:text="${usuarioPerfil.nomeCompleto()}">Nome do Usu√°rio</h1>
            <p class="profile-summary__email" th:text="${usuarioPerfil.email()}">usuario@exemplo.com</p>
            <div class="profile-summary__meta">
                <span>
                    <strong>Perfil:</strong>
                    <span th:text="${usuarioPerfil.role()}">ADMIN</span>
                </span>
                <span th:if="${usuarioPerfil.ultimoAcesso() != null}">
                    <strong>√öltimo acesso:</strong>
                    <span th:text="${#temporals.format(usuarioPerfil.ultimoAcesso(), 'dd/MM/yyyy HH:mm')}"></span>
                </span>
                <span th:if="${usuarioPerfil.senhaAtualizadaEm() != null}">
                    <strong>Senha atualizada em:</strong>
                    <span th:text="${#temporals.format(usuarioPerfil.senhaAtualizadaEm(), 'dd/MM/yyyy HH:mm')}"></span>
                </span>
                <span th:if="${usuarioPerfil.perfilAtualizadoEm() != null}">
                    <strong>Perfil atualizado em:</strong>
                    <span th:text="${#temporals.format(usuarioPerfil.perfilAtualizadoEm(), 'dd/MM/yyyy HH:mm')}"></span>
                </span>
            </div>
        </div>
    </section>

    <section class="profile-sections">
        <article class="profile-card">
            <header class="profile-card__header">
                <h2>Informa√ß√µes da conta</h2>
                <p>Atualize seus dados b√°sicos e informa√ß√µes de contato.</p>
            </header>

            <div th:if="${perfilAtualizado}" class="feedback success">
                Dados atualizados com sucesso!
            </div>

            <form th:action="@{/perfil/dados}" th:object="${profileForm}" method="post" class="profile-form" novalidate>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div class="form-group" th:classappend="${#fields.hasErrors('nomeCompleto')} ? ' has-error'">
                    <label for="nomeCompleto">Nome completo</label>
                    <input id="nomeCompleto" type="text" th:field="*{nomeCompleto}" placeholder="Seu nome completo" required />
                    <small th:if="${#fields.hasErrors('nomeCompleto')}" th:errors="*{nomeCompleto}"></small>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('email')} ? ' has-error'">
                    <label for="email">Email</label>
                    <input id="email" type="email" th:field="*{email}" placeholder="usuario@exemplo.com" required />
                    <small th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></small>
                </div>

                <div class="form-group">
                    <label for="telefone">Telefone</label>
                    <input id="telefone" type="text" th:field="*{telefone}" placeholder="(00) 00000-0000" />
                    <small th:if="${#fields.hasErrors('telefone')}" th:errors="*{telefone}"></small>
                </div>

                <div class="form-group">
                    <label for="avatarUrl">URL de avatar</label>
                    <input id="avatarUrl" type="url" th:field="*{avatarUrl}" placeholder="https://..." />
                    <small th:if="${#fields.hasErrors('avatarUrl')}" th:errors="*{avatarUrl}"></small>
                </div>

                <div class="form-group">
                    <label for="bio">Sobre voc√™</label>
                    <textarea id="bio" th:field="*{bio}" rows="4" placeholder="Compartilhe informa√ß√µes importantes sobre seu perfil profissional."></textarea>
                    <small th:if="${#fields.hasErrors('bio')}" th:errors="*{bio}"></small>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvar altera√ß√µes</button>
                </div>
            </form>
        </article>

        <article class="profile-card">
            <header class="profile-card__header">
                <h2>Seguran√ßa</h2>
                <p>Troque sua senha regularmente para manter sua conta protegida.</p>
            </header>

            <div th:if="${senhaAtualizada}" class="feedback success">
                Senha alterada com sucesso!
            </div>

            <form th:action="@{/perfil/senha}" th:object="${passwordForm}" method="post" class="profile-form" novalidate>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div th:if="${#fields.hasGlobalErrors()}" class="feedback error">
                    <span th:each="erro : ${#fields.globalErrors()}" th:text="${erro}">Erro ao alterar senha</span>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('senhaAtual')} ? ' has-error'">
                    <label for="senhaAtual">Senha atual</label>
                    <input id="senhaAtual" type="password" th:field="*{senhaAtual}" placeholder="Digite sua senha atual" required />
                    <small th:if="${#fields.hasErrors('senhaAtual')}" th:errors="*{senhaAtual}"></small>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('novaSenha')} ? ' has-error'">
                    <label for="novaSenha">Nova senha</label>
                    <input id="novaSenha" type="password" th:field="*{novaSenha}" placeholder="Digite a nova senha" required />
                    <small class="helper-text">M√≠nimo de 8 caracteres. Use letras, n√∫meros e s√≠mbolos.</small>
                    <small th:if="${#fields.hasErrors('novaSenha')}" th:errors="*{novaSenha}"></small>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('confirmarSenha')} ? ' has-error'">
                    <label for="confirmarSenha">Confirmar nova senha</label>
                    <input id="confirmarSenha" type="password" th:field="*{confirmarSenha}" placeholder="Repita a nova senha" required />
                    <small th:if="${#fields.hasErrors('confirmarSenha')}" th:errors="*{confirmarSenha}"></small>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-secondary">Atualizar senha</button>
                </div>
            </form>
        </article>
    </section>
</main>

</body>
</html>

